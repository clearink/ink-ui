var f=Object.defineProperty;var w=(n,e,t)=>e in n?f(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>w(n,typeof e!="symbol"?e+"":e,t);import{m as x,i as k}from"./node-equal-DdU5tx-g.js";import{r as c,j as m}from"./index-CtQgf38W.js";import{u as _,a as y,b as a,C as I,r as g,c as S}from"./index-DjnRMsMa.js";import{o as p}from"./index-D8thIb-8.js";function i(n,e){const t=e>=0?e:n.length+e;return n[t]}function l(n){const{components:e,elements:t}=n,{key:s}=i(t,0),o=e.get(s);return!o||o.isExited}function d(n){const{components:e,elements:t}=n;if(t.length<2)return!1;const{key:s}=i(t,-1),o=e.get(s);return!o||o.isEntered}const E=["children","mode","when"];class C{constructor(e){r(this,"elements",[]);r(this,"components",new Map);this._props=e,this.current=e.children}}class b{constructor(e,t){r(this,"uniqueId",x("st-"));r(this,"makeElement",(e,t)=>{const s=e.key,o=p(this._props,E);return Object.assign(o,t,{ref:u=>{u?this.components.set(s,u):this.components.delete(s)},key:this.uniqueId(),when:!0}),{freeze:!1,node:c.createElement(I,o,e),key:s}});r(this,"cloneElement",(e,t)=>{let{node:s,key:o}=e;const h=p(this._props,E);return Object.assign(h,t),{freeze:!0,node:c.cloneElement(s,h),key:o}});r(this,"setInnerProps",e=>{this.states._props=e});r(this,"setCurrent",e=>{this.states.current=e});r(this,"setElements",e=>{const t=new Map;e.forEach(s=>{t.set(s.node.key,s)}),this.states.elements=Array.from(t.values()),this.forceUpdate()});r(this,"runDefaultSwitch",()=>{this.setCurrent(this._props.children);const e=g(2,()=>{this.setElements([i(this.elements,-1)])}),t=d(this.states),s=l(this.states);t&&e(),s&&e(),t&&s||this.setElements([this.cloneElement(i(this.elements,-1),{appear:!0,when:!1,onExited:a(this._props.onExited,e)}),this.makeElement(this.states.current,{appear:!0,onEntered:a(this._props.onEntered,e)})])});r(this,"runInOutSwitch",()=>{this.setCurrent(this._props.children);const e=()=>{const s=()=>{this.setElements([i(this.elements,-1)])};l(this.states)?s():this.setElements([this.cloneElement(i(this.elements,0),{when:!1,onExited:a(this._props.onExited,s)}),i(this.elements,-1)])},t=d(this.states);this.setElements([this.cloneElement(i(this.elements,-1),null),this.makeElement(this.states.current,{appear:!0,onEntered:a(this._props.onEntered,e)})]),t&&e()});r(this,"runOutInSwitch",()=>{const e=()=>{this.setCurrent(this._props.children),this.setElements([this.makeElement(this.states.current,{appear:!0})])};l(this.states)?e():this.setElements([this.cloneElement(i(this.elements,0),{appear:!0,when:!1,onExited:a(this._props.onExited,e)})])});r(this,"renderNodes",e=>this.elements.map(t=>(t.freeze||t.key!==e.key||e!==t.node.props.children&&(t.node=c.cloneElement(t.node,void 0,e)),t.node)));this.forceUpdate=e,this.states=t,t.elements=[this.makeElement(t.current)]}get _props(){return this.states._props}get elements(){return this.states.elements}get components(){return this.states.components}}function O(n){const e=_(),t=y(()=>new C(n)),s=c.useMemo(()=>new b(e,t),[e,t]);return c.useMemo(()=>{s.setInnerProps(n)},[s,n]),{actions:s,states:t}}function M(n){const{children:e,mode:t}=n,{actions:s,states:o}=O(n);return S(e,()=>k(o.current,e)?!1:(t==="out-in"?s.runOutInSwitch():t==="in-out"?s.runInOutSwitch():s.runDefaultSwitch(),!0))?null:m.jsx(m.Fragment,{children:s.renderNodes(e)})}export{M as S};
