var V=Object.defineProperty;var z=(e,t,s)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var c=(e,t,s)=>z(e,typeof t!="symbol"?t+"":t,s);import{n as T,B as v}from"./index-BCotE9pn.js";import{J as I,K as L,g as W,r as p,q as A,L as q,j as o,c as h,d as H,h as J,w as G,C as Q,a as U,b as X,n as S,i as Y,f as _}from"./index-Brttm9hb.js";import{k as R}from"./keyboard-DDjTZLpe.js";import{u as Z}from"./index-Dr-zX5iv.js";import{i as ee}from"./is-null-D6OXYL3N.js";import{p as se}from"./pick-BK4giCUn.js";import{O as te}from"./index-CwpYMIc_.js";const O={position:"fixed",overflow:"hidden",width:0,height:0,top:-1,left:-1,padding:0};function F(e){e&&e.focus({preventScroll:!0})}function ne(e,t){let s=e.nextElementSibling;const a=[];for(;s&&s!==t;)s&&a.push(s),s=(s==null?void 0:s.nextElementSibling)||null;return a}class oe{constructor(){c(this,"stack",[]);c(this,"keydownCleanup",T);c(this,"focusinCleanup",T);c(this,"init",t=>{const s=a=>r=>{const n=L(this.stack,-1);n&&n[a](r)};this.keydownCleanup=I(t,"keydown",s("onKeyDown"),!0),this.focusinCleanup=I(t,"focusin",s("onFocusIn"))});c(this,"cleanup",()=>{this.keydownCleanup(),this.focusinCleanup()});c(this,"register",(t,s)=>(this.stack.length||this.init(t),this.stack.push(s),()=>{this.stack=this.stack.filter(a=>a!==s),this.stack.length||this.cleanup()}))}get size(){return this.stack.length}}const ae=new oe;class re{constructor(){c(this,"$start",{current:null});c(this,"$end",{current:null});c(this,"isShiftTab",!1);c(this,"latestFocus",null);c(this,"returnFocus",null);c(this,"reset",()=>{this.latestFocus=null,this.returnFocus=null})}get start(){return this.$start.current}get end(){return this.$end.current}}function le(){const e=W(()=>new re);return{refs:e,handleCleanup:()=>{e.latestFocus=null,e.returnFocus=null},handleFocusTrap:a=>{const r=l=>{const u=ne(e.start,e.end);if(!u.length||!l)return;const d=a.activeElement;if(d!==e.start&&d!==e.end){if(u.some(f=>f===l||f.contains(l))){e.latestFocus=l;return}if(e.latestFocus)return F(e.latestFocus)}F(e.isShiftTab?e.end:e.start)},n=l=>{e.isShiftTab=l.key===R.tab&&l.shiftKey,r(l.target)},y=l=>{l.stopImmediatePropagation(),r(l.target)};return ae.register(a,{onFocusIn:y,onKeyDown:n})}}}function ie(e,t){const{active:s,children:a,onExit:r}=e,{refs:n,handleCleanup:y,handleFocusTrap:l}=le();p.useImperativeHandle(t,()=>({focus:()=>{F(n.start)}}));const u=A(()=>{if(!s)return;const d=q(n.start);n.returnFocus=d.activeElement;const f=l(d);return()=>{f(),r==null||r(n.returnFocus),y()}});return p.useEffect(()=>u(),[s,u]),p.useEffect(()=>()=>{n.reset()},[n]),o.jsxs(o.Fragment,{children:[o.jsx("div",{ref:n.$start,style:O,tabIndex:s?0:-1}),a,o.jsx("div",{ref:n.$end,style:O,tabIndex:s?0:-1})]})}const ce=p.forwardRef(ie);function ue(e,t,s){const{className:a,classNames:r={}}=t;return{root:h(e,s==null?void 0:s.className,a,r.root),body:h(`${e}__body`,r.body),closeBtn:h(`${e}__close-btn`,r.closeBtn),footer:h(`${e}__footer`,r.footer),header:h(`${e}__header`,r.header),main:h(`${e}__main`,r.main)}}function de(e){const[t,s]=H(e);return[J(e,()=>{e&&s(!0)}),t,s]}const fe={closeOnEscape:!0,closable:!0,mask:!0,maskClosable:!0,returnFocus:!0},pe=["getContainer","mask","isOpen","transitions","keepMounted","unmountOnExit","zIndex"];function he(e){const t=G(e,fe),{children:s,footer:a,modalRender:r,onCancel:n,onOk:y,isOpen:l,title:u,transitions:d={}}=t,{modal:f}=Q.useState(),[B,E,C]=de(l),j=p.useRef(null),w=p.useRef(null),$=p.useId(),g=U(),x=`${g}-modal`,m=ue(x,t,f),k=X(t,f),[me,D]=Z(t,f,{closeIconRender:i=>o.jsx("button",{className:m.closeBtn,style:k.closeBtn,"aria-label":"close",type:"button",onClick:n,children:i})}),M=t.closeOnEscape?i=>{i.key===R.esc&&(i.stopPropagation(),n==null||n())}:void 0,K=!t.maskClosable||!t.mask?void 0:i=>{i.target&&i.target===j.current&&(n==null||n())},P=t.returnFocus?i=>{const b=i;b&&S(b.focus)&&b.focus()}:void 0;if(B)return null;const N=o.jsxs("div",{className:m.main,style:k.main,children:[D,o.jsx("div",{className:m.header,style:k.header,children:!Y(u)&&o.jsx("span",{className:`${x}__title`,id:$,children:u})}),o.jsx("div",{className:m.body,style:k.body,children:s}),!ee(a)&&o.jsxs("div",{className:m.footer,style:k.footer,children:[o.jsx(v,{onClick:n,children:"取消"}),o.jsx(v,{variant:"filled",onClick:y,children:"确定"})]})]});return o.jsx(te,{...se(t,pe),classNames:{mask:`${x}-mask`},transitions:{content:_(d.content,`${g}-zoom-in`),mask:_(d.mask,`${g}-fade-in`)},onEnter:()=>{var i;console.log(E),C(!0),(i=w.current)==null||i.focus()},onEntered:()=>{},onExit:()=>{},onExited:()=>{C(!1)},children:(i,b)=>o.jsx("div",{ref:j,tabIndex:-1,className:`${x}-wrapper`,style:{display:E?void 0:"none"},onClick:K,onKeyDown:M,children:o.jsx("div",{ref:i,className:h(m.root,b),style:k.root,"aria-labelledby":u?$:void 0,"aria-modal":"true",role:"dialog",children:o.jsx(ce,{ref:w,active:l,onExit:P,children:S(r)?r(N):N})})})})}function Ce(){const[e,t]=p.useState(!1),s=()=>{t(!0)},a=()=>{t(!1)};return o.jsxs(o.Fragment,{children:[o.jsx(v,{onClick:s,children:"open"}),o.jsx(he,{isOpen:e,onCancel:a,children:o.jsx("div",{children:"12331141341"})})]})}export{Ce as A};
